# CRUD Operations in Entity Framework Core

CRUD operations stand for **Create, Read, Update, and Delete**, and these operations on data are the foundation of any interaction with a database. This guide explains the basic CRUD operations and their implementation in EF Core.

## DbContext Components

Before diving into CRUD operations, let's explore the key components of `DbContext` that provide the tools to perform CRUD operations efficiently.

### DbSet
A `DbSet` represents a table in your database. Each entity class, like `Employee`, is mapped to a specific `DbSet`, which acts as a collection of entities that you can query, add, update, or delete.

```csharp
public class ApplicationDbContext : DbContext
{
    public DbSet<Employee> Employees { get; set; }
    public DbSet<Department> Departments { get; set; }
}
```

### SaveChanges()
`SaveChanges()` commits the changes made in the `DbContext` to the database. Whether you're adding, updating, or deleting, calling `SaveChanges()` finalizes the operation and saves your modifications. Without this method, your operations won't be reflected in the actual database.

## CRUD Operations Overview

CRUD stands for:
- **C**reate - Add new records
- **R**ead - Retrieve existing data
- **U**pdate - Modify existing records
- **D**elete - Remove records

## Create Operation

The Create operation allows you to add new records to your database. In `DbContext`, you can use the `Add()` method to create new records.

### Implementation Steps:
1. Create a new instance of an entity and populate its properties
2. Add it to the `DbSet` using the `Add()` method
3. Call `SaveChanges()` to persist the new record in the database

```csharp
using (var context = new ApplicationDbContext())
{
    // Step 1: Create a new entity instance
    var newEmployee = new Employee
    {
        FirstName = "John",
        LastName = "Doe",
        Email = "john.doe@company.com",
        DepartmentId = 1
    };

    // Step 2: Add to DbSet
    context.Employees.Add(newEmployee);

    // Step 3: Save changes
    context.SaveChanges();
}
```

## Read Operation

The Read operation lets you retrieve existing data from your database. This is commonly done through querying the data to display it or process it further.

### Common Read Methods:
- `Find()` - Get a single record by primary key
- `FirstOrDefault()` - Retrieve the first matching record
- `ToList()` - Retrieve multiple records

```csharp
using (var context = new ApplicationDbContext())
{
    // Find by ID
    var employee = context.Employees.Find(1);

    // First matching record
    var firstEmployee = context.Employees
        .FirstOrDefault(e => e.LastName == "Doe");

    // Multiple records
    var allEmployees = context.Employees.ToList();

    // Query with conditions
    var departmentEmployees = context.Employees
        .Where(e => e.DepartmentId == 1)
        .ToList();
}
```

## Update Operation

The Update operation lets you modify existing records. When something changes, you perform an update to reflect the new information in your database.

### Implementation Steps:
1. Retrieve the entity from the `DbSet` using `Find()` or query methods
2. Modify its properties
3. Call `SaveChanges()`

```csharp
using (var context = new ApplicationDbContext())
{
    // Step 1: Retrieve the entity
    var employee = context.Employees.Find(1);

    if (employee != null)
    {
        // Step 2: Modify properties
        employee.Email = "john.doe.updated@company.com";
        employee.LastName = "Smith";

        // Step 3: Save changes
        // EF Core automatically tracks changes
        context.SaveChanges();
    }
}
```

### Alternative Update Method:
```csharp
using (var context = new ApplicationDbContext())
{
    var updatedEmployee = new Employee
    {
        Id = 1,
        FirstName = "John",
        LastName = "Smith",
        Email = "john.smith@company.com",
        DepartmentId = 1
    };

    context.Employees.Update(updatedEmployee);
    context.SaveChanges();
}
```

## Delete Operation

The Delete operation is used to remove records from your database. Once a record is no longer needed, you can delete it to free up space or clean up your data.

### Implementation Steps:
1. Retrieve the record you want to remove using `Find()` or query methods
2. Pass it to the `Remove()` method
3. Call `SaveChanges()`

```csharp
using (var context = new ApplicationDbContext())
{
    // Step 1: Retrieve the entity
    var employee = context.Employees.Find(1);

    if (employee != null)
    {
        // Step 2: Mark for deletion
        context.Employees.Remove(employee);

        // Step 3: Save changes
        context.SaveChanges();
    }
}
```

### Delete Multiple Records:
```csharp
using (var context = new ApplicationDbContext())
{
    var employeesToDelete = context.Employees
        .Where(e => e.DepartmentId == 1)
        .ToList();

    context.Employees.RemoveRange(employeesToDelete);
    context.SaveChanges();
}
```

## Complete Example: Employee Management

Here's a complete example showing all CRUD operations in a single class:

```csharp
public class EmployeeService
{
    private readonly ApplicationDbContext _context;

    public EmployeeService(ApplicationDbContext context)
    {
        _context = context;
    }

    // CREATE
    public void CreateEmployee(Employee employee)
    {
        _context.Employees.Add(employee);
        _context.SaveChanges();
    }

    // READ
    public Employee GetEmployee(int id)
    {
        return _context.Employees.Find(id);
    }

    public List<Employee> GetAllEmployees()
    {
        return _context.Employees.ToList();
    }

    // UPDATE
    public void UpdateEmployee(Employee employee)
    {
        _context.Employees.Update(employee);
        _context.SaveChanges();
    }

    // DELETE
    public void DeleteEmployee(int id)
    {
        var employee = _context.Employees.Find(id);
        if (employee != null)
        {
            _context.Employees.Remove(employee);
            _context.SaveChanges();
        }
    }
}
```

## Key Takeaways

- **DbSet** represents a table and enables CRUD operations on entities
- **SaveChanges()** is essential for persisting changes to the database
- EF Core automatically tracks entity changes for updates
- Always check for null when retrieving entities before performing operations
- Use appropriate methods (`Find`, `FirstOrDefault`, `ToList`) based on your data retrieval needs

By mastering these essential CRUD operations in EF Core, you unlock the potential to manage data effectively in any application.