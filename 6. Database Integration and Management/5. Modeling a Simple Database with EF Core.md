# Entity Framework Core Tutorial: Building a Database Model

This tutorial covers setting up Entity Framework Core (EF Core) with SQLite to create a database model with relationships, apply migrations, and test the implementation.

## Overview

In this lab, we will:
- Set up a development environment with EF Core
- Create and configure entity classes representing database tables
- Use DbContext to manage database relationships
- Apply migrations to generate the database schema
- Test the database model by inserting and querying data

## Step 1: Set Up the Application

First, create a new console application and add the necessary dependencies.

### Create the Project
```bash
dotnet new console -n EFCoreModelApp
cd EFCoreModelApp
```

### Add Dependencies
```bash
dotnet add package Microsoft.EntityFrameworkCore.Sqlite
dotnet add package Microsoft.EntityFrameworkCore.Tools
```

## Step 2: Create Entity Classes

### Employee.cs
Create the Employee entity class with the following properties:

```csharp
using System.ComponentModel.DataAnnotations;

public class Employee
{
    public int EmployeeId { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public string Email { get; set; }
    public decimal Salary { get; set; }
    
    // Foreign key
    public int DepartmentId { get; set; }
    
    // Navigation property
    public Department Department { get; set; }
}
```

### Department.cs
Create the Department entity class that references the Employee class:

```csharp
using System.Collections.Generic;

public class Department
{
    public int DepartmentId { get; set; }
    public string Name { get; set; }
    
    // Navigation property - one department can have many employees
    public List<Employee> Employees { get; set; } = new List<Employee>();
}
```

## Step 3: Configure the DbContext

### CompanyContext.cs
Set up the DbContext to manage our entity classes:

```csharp
using Microsoft.EntityFrameworkCore;

public class CompanyContext : DbContext
{
    public DbSet<Employee> Employees { get; set; }
    public DbSet<Department> Departments { get; set; }
    
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite("Data Source=CompanyDB.db");
    }
}
```

## Step 4: Apply Migrations

### Create Migration
Generate the initial migration based on your entity classes:

```bash
dotnet ef migrations add InitialCreate
```

This command creates a `Migrations` folder with the migration files that define how to create your database schema.

### Update Database
Apply the migration to create the actual database:

```bash
dotnet ef database update
```

This creates the `CompanyDB.db` file in your project folder with the appropriate tables and relationships.

## Step 5: Test the Database Model

### Program.cs
Test your database by inserting data and querying it:

```csharp
using System;
using System.Linq;

class Program
{
    static void Main(string[] args)
    {
        using (var context = new CompanyContext())
        {
            // Create a new department
            var engineeringDept = new Department
            {
                Name = "Engineering"
            };
            
            // Add employees to the department
            engineeringDept.Employees.Add(new Employee
            {
                FirstName = "John",
                LastName = "Smith",
                Email = "john.smith@company.com",
                Salary = 75000
            });
            
            engineeringDept.Employees.Add(new Employee
            {
                FirstName = "Jane",
                LastName = "Doe",
                Email = "jane.doe@company.com",
                Salary = 80000
            });
            
            // Add department to context
            context.Departments.Add(engineeringDept);
            
            // Save changes to database
            context.SaveChanges();
            
            // Query the database to get employee count
            var employeeCount = context.Employees.Count();
            
            Console.WriteLine($"Total employees in Engineering: {employeeCount}");
        }
    }
}
```

## Expected Output

When you run the application:
```
Total employees in Engineering: 2
```

## Key Concepts Explained

### Entity Classes
- **Employee** and **Department** are entity classes that represent database tables
- Properties in these classes become columns in the database
- Navigation properties establish relationships between entities

### DbContext
- **CompanyContext** inherits from `DbContext` and manages entity instances
- `DbSet<T>` properties represent collections that can be queried
- `OnConfiguring` method sets up the database connection

### Migrations
- Migrations are version control for your database schema
- `dotnet ef migrations add` creates a new migration
- `dotnet ef database update` applies pending migrations to the database

### Relationships
- **One-to-Many**: One Department can have many Employees
- **Foreign Key**: `DepartmentId` in Employee links to Department
- **Navigation Properties**: Allow easy traversal between related entities

This approach demonstrates how Entity Framework Core uses C# classes to create powerful database operations with minimal code.


// Create Migrations
dotnet ef migrations add [Name of migration]

// Run Migrations
dotnet ef database update  

For SQLITE packages:
 - Microsoft.EntityFrameworkCore.Sqlite.Core
 - Microsoft.EntityFrameworkCore.Tools
 - Microsoft.EntityFrameworkCore.Design
 - SQLitePCLRaw.bundle_e_sqlite3
 
Add Batteries.Init(); in DBContext inheriting class in its constructor 

## Local package installations per folder not global
To install dotnet tools locally only in a specific folder/project then 
 - dotnet new tool-manifest
 - dotnet tool install dotnet-ef
 
 
 Run migrations with this command 
 
 dotnet ef migrations add InitialCreate --project EfcoreTwo --startup-project EfcoreTwo

. Design-Time Context (Command Line) - using IDesignTimeDbContextFactory

Runtime Context (dbContext.Database.Migrate())