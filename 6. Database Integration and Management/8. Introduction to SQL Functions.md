# SQL Functions for Data Manipulation and Transformation

## Introduction

Data is more than static rows and columns. It represents dynamic information that can be used for various purposes. Raw data often requires reshaping and transforming to fit analysis or reporting needs, like combining names or extracting specific portions for clarity.

SQL provides powerful functions that allow us to manipulate data so that it can be better understood and applied to real-world needs, like creating reports, generating insights, or improving user experiences.

## What are SQL Functions?

**SQL functions** are predefined operations in SQL that allow you to perform specific tasks on your data, like manipulating or transforming it. These functions can:

- Modify text
- Calculate values
- Extract information
- Aggregate data

This makes it easier to retrieve and present data in a useful format. SQL functions are typically used within SQL queries to process data directly from the database's tables, without the need for external programming.

## Sample Database Setup

Let's create a sample table to demonstrate these functions:

```sql
CREATE TABLE music_catalog (
    artist_id INT PRIMARY KEY,
    artist_first_name VARCHAR(50),
    artist_last_name VARCHAR(50),
    artist_email VARCHAR(100),
    album_title VARCHAR(100),
    genre VARCHAR(30)
);

INSERT INTO music_catalog VALUES
(1, 'John', 'Lennon', 'JOHN.LENNON@BEATLES.COM', 'Imagine', 'Rock'),
(2, 'taylor', 'Swift', 'taylor.swift@music.com', '1989', 'Pop'),
(3, 'Bob', 'Dylan', 'BOB.DYLAN@FOLK.COM', 'Highway 61 Revisited', 'Folk'),
(4, 'beyonce', 'Knowles', 'beyonce@destiny.com', 'Lemonade', 'R&B'),
(5, 'Elvis', 'Presley', 'ELVIS@GRACELAND.COM', 'Blue Hawaii', 'Rock');
```

## String Manipulation Functions

### 1. CONCAT Function

The **CONCAT** function allows you to join multiple strings into one. For example, if you want to combine a first name and a last name into a full name, CONCAT is the tool you'd use.

**Syntax:**
```sql
CONCAT(expression1, expression2, ...)
```

**Example: Combining first and last names**
```sql
SELECT 
    CONCAT(artist_first_name, ' ', artist_last_name) AS artist_full_name
FROM music_catalog;
```

**Result:**
```
artist_full_name
-----------------
John Lennon
taylor Swift
Bob Dylan
beyonce Knowles
Elvis Presley
```

**Advanced CONCAT Examples:**
```sql
-- Combining multiple fields with formatting
SELECT 
    CONCAT(artist_first_name, ' ', artist_last_name, ' - ', album_title) AS artist_album
FROM music_catalog;

-- Adding prefixes and suffixes
SELECT 
    CONCAT('Artist: ', UPPER(artist_first_name), ' ', UPPER(artist_last_name)) AS formatted_artist
FROM music_catalog;
```

### 2. LEN/LENGTH Function

The **LEN** function (or **LENGTH** in some database systems) helps you count the number of characters in your data, including spaces and punctuation.

**Syntax:**
```sql
LEN(expression)  -- SQL Server, Access
LENGTH(expression)  -- MySQL, PostgreSQL, SQLite
```

**Example: Finding the length of artist last names**
```sql
SELECT 
    artist_last_name,
    LEN(artist_last_name) AS last_name_length
FROM music_catalog;
```

**Result:**
```
artist_last_name | last_name_length
-----------------|------------------
Lennon           | 6
Swift            | 5
Dylan            | 5
Knowles          | 7
Presley          | 7
```

**Practical LENGTH Examples:**
```sql
-- Find artists with long email addresses
SELECT 
    artist_first_name,
    artist_last_name,
    artist_email,
    LEN(artist_email) AS email_length
FROM music_catalog
WHERE LEN(artist_email) > 20
ORDER BY email_length DESC;

-- Get average length of album titles
SELECT 
    AVG(LEN(album_title)) AS avg_album_title_length
FROM music_catalog;
```

### 3. UPPER Function

The **UPPER** function is perfect for converting names or text to uppercase for consistency.

**Syntax:**
```sql
UPPER(expression)
```

**Example: Converting artist first names to uppercase**
```sql
SELECT 
    UPPER(artist_first_name) AS artist_first_name_upper,
    artist_last_name
FROM music_catalog;
```

**Result:**
```
artist_first_name_upper | artist_last_name
------------------------|------------------
JOHN                    | Lennon
TAYLOR                  | Swift
BOB                     | Dylan
BEYONCE                 | Knowles
ELVIS                   | Presley
```

**Practical UPPER Examples:**
```sql
-- Standardize all text fields for consistency
SELECT 
    UPPER(artist_first_name) AS first_name,
    UPPER(artist_last_name) AS last_name,
    UPPER(genre) AS genre_category
FROM music_catalog;

-- Create standardized full names
SELECT 
    CONCAT(UPPER(artist_first_name), ' ', UPPER(artist_last_name)) AS standardized_name
FROM music_catalog;
```

### 4. LOWER Function

The **LOWER** function converts text to lowercase, which is useful for standardizing data entry or email addresses.

**Syntax:**
```sql
LOWER(expression)
```

**Example: Converting email addresses to lowercase**
```sql
SELECT 
    artist_first_name,
    LOWER(artist_email) AS artist_email_lower
FROM music_catalog;
```

**Result:**
```
artist_first_name | artist_email_lower
------------------|--------------------
John              | john.lennon@beatles.com
taylor            | taylor.swift@music.com
Bob               | bob.dylan@folk.com
beyonce           | beyonce@destiny.com
Elvis             | elvis@graceland.com
```

**Practical LOWER Examples:**
```sql
-- Standardize email addresses for consistency
UPDATE music_catalog 
SET artist_email = LOWER(artist_email);

-- Create lowercase versions for search functionality
SELECT 
    artist_first_name,
    LOWER(artist_first_name) AS search_first_name,
    LOWER(artist_last_name) AS search_last_name
FROM music_catalog;
```

### 5. SUBSTRING Function

The **SUBSTRING** function allows you to select exactly the portion of text you need. It extracts a part of a string based on your specific starting point and length.

**Syntax:**
```sql
SUBSTRING(expression, start_position, length)
```

**Example: Extracting first three letters of last names**
```sql
SELECT 
    artist_last_name,
    SUBSTRING(artist_last_name, 1, 3) AS artist_last_name_snippet
FROM music_catalog;
```

**Result:**
```
artist_last_name | artist_last_name_snippet
-----------------|-------------------------
Lennon           | Len
Swift            | Swi
Dylan            | Dyl
Knowles          | Kno
Presley          | Pre
```

**Advanced SUBSTRING Examples:**
```sql
-- Extract domain from email addresses
SELECT 
    artist_email,
    SUBSTRING(artist_email, CHARINDEX('@', artist_email) + 1, LEN(artist_email)) AS email_domain
FROM music_catalog;

-- Get initials from names
SELECT 
    CONCAT(
        SUBSTRING(artist_first_name, 1, 1), 
        '.', 
        SUBSTRING(artist_last_name, 1, 1), 
        '.'
    ) AS initials
FROM music_catalog;

-- Extract year from album title (where applicable)
SELECT 
    album_title,
    CASE 
        WHEN album_title LIKE '%[0-9][0-9][0-9][0-9]%' 
        THEN SUBSTRING(album_title, PATINDEX('%[0-9][0-9][0-9][0-9]%', album_title), 4)
        ELSE 'No year found'
    END AS extracted_year
FROM music_catalog;
```

## Combining Functions

You can combine multiple functions to create powerful data transformations:

```sql
-- Create formatted artist display with proper capitalization and shortened last names
SELECT 
    CONCAT(
        UPPER(SUBSTRING(artist_first_name, 1, 1)),
        LOWER(SUBSTRING(artist_first_name, 2, LEN(artist_first_name))),
        ' ',
        UPPER(SUBSTRING(artist_last_name, 1, 3))
    ) AS formatted_display,
    LOWER(artist_email) AS contact_email
FROM music_catalog;

-- Create standardized search terms
SELECT 
    artist_id,
    UPPER(CONCAT(artist_first_name, ' ', artist_last_name)) AS search_name,
    LEN(CONCAT(artist_first_name, artist_last_name)) AS name_char_count
FROM music_catalog
ORDER BY name_char_count;
```

## Practical Use Cases

### Data Cleaning
```sql
-- Standardize inconsistent data entry
SELECT 
    artist_id,
    CONCAT(
        UPPER(SUBSTRING(LOWER(artist_first_name), 1, 1)),
        LOWER(SUBSTRING(artist_first_name, 2, LEN(artist_first_name)))
    ) AS cleaned_first_name,
    LOWER(artist_email) AS cleaned_email
FROM music_catalog;
```

### Report Generation
```sql
-- Create a formatted report
SELECT 
    CONCAT('Artist: ', UPPER(artist_first_name), ' ', UPPER(artist_last_name)) AS artist_info,
    CONCAT('Album: "', album_title, '" (', UPPER(genre), ')') AS album_info,
    CONCAT('Contact: ', LOWER(artist_email)) AS contact_info
FROM music_catalog
ORDER BY artist_last_name;
```

### Search Optimization
```sql
-- Create search-friendly versions of data
SELECT 
    artist_id,
    LOWER(CONCAT(artist_first_name, artist_last_name)) AS search_key,
    SUBSTRING(LOWER(artist_last_name), 1, 1) AS alphabetical_grouping
FROM music_catalog
ORDER BY alphabetical_grouping, search_key;
```

## Key Points to Remember

- **CONCAT**: Combines multiple strings into one
- **LEN/LENGTH**: Counts characters in a string
- **UPPER**: Converts text to uppercase
- **LOWER**: Converts text to lowercase  
- **SUBSTRING**: Extracts specific portions of text
- Functions can be combined for complex transformations
- Always consider data consistency when applying text functions
- Use aliases to make your results more readable

The more you apply these techniques, the more intuitive they will become. Keep exploring, and you'll soon notice how powerful SQL functions can be in managing and transforming data for real-world applications.