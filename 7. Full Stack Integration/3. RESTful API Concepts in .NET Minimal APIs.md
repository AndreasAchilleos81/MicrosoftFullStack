# RESTful APIs with .NET Minimal API Framework

## Introduction

APIs are the hidden foundation of digital services, allowing software to interact and exchange data seamlessly. Today, they are essential in everything from mobile apps to e-commerce platforms. This guide explains the structure and purpose of RESTful APIs within the .NET Minimal API Framework.

APIs come in different types. **RESTful APIs are unique because they follow specific rules and are stateless.** Stateless means that each request a client makes to an API is independent. This design makes them scalable and efficient.

## Key Components of RESTful APIs

### 1. Endpoints

Endpoints are URLs where APIs receive requests and return responses. Endpoints are like addresses for specific tasks, making APIs clear and predictable.

**Examples:**
- `https://mydomain.com/products` - List items for sale
- `https://mydomain.com/orders` - Handle new orders

```csharp
// .NET Minimal API endpoint examples
var app = WebApplication.Create();

// Products endpoint
app.MapGet("/products", () => 
{
    // Return list of products
    return Results.Ok(new[] { "Product 1", "Product 2", "Product 3" });
});

// Orders endpoint
app.MapGet("/orders", () => 
{
    // Return list of orders
    return Results.Ok(new[] { "Order 1", "Order 2" });
});
```

### 2. HTTP Methods

HTTP methods specify the type of action that a call to an API endpoint will perform. The four primary HTTP methods are:

#### GET - Retrieve Information
Used to retrieve information from a server without changing the data.

```csharp
// GET: Retrieve all products
app.MapGet("/products", () => 
{
    var products = new[]
    {
        new { Id = 1, Name = "Laptop", Price = 999.99 },
        new { Id = 2, Name = "Mouse", Price = 29.99 }
    };
    return Results.Ok(products);
});

// GET: Retrieve specific product by ID
app.MapGet("/products/{id}", (int id) => 
{
    var product = new { Id = id, Name = "Laptop", Price = 999.99 };
    return Results.Ok(product);
});
```

#### POST - Add New Data
Used for adding new data to a data store.

```csharp
// POST: Create new order
app.MapPost("/orders", (Order order) => 
{
    // Save order to database
    order.Id = GenerateNewId();
    order.CreatedDate = DateTime.UtcNow;
    
    return Results.Created($"/orders/{order.Id}", order);
});

public record Order(int Id, int ProductId, int Quantity, DateTime CreatedDate);
```

#### PUT - Update Existing Data
Used to update existing data completely.

```csharp
// PUT: Update existing order
app.MapPut("/orders/{id}", (int id, Order updatedOrder) => 
{
    // Find and update the order with the specified ID
    var existingOrder = FindOrderById(id);
    if (existingOrder == null)
    {
        return Results.NotFound();
    }
    
    // Update the order
    existingOrder.ProductId = updatedOrder.ProductId;
    existingOrder.Quantity = updatedOrder.Quantity;
    
    return Results.Ok(existingOrder);
});
```

#### DELETE - Remove Data
Used to remove data from the system.

```csharp
// DELETE: Remove an order
app.MapDelete("/orders/{id}", (int id) => 
{
    var order = FindOrderById(id);
    if (order == null)
    {
        return Results.NotFound();
    }
    
    // Delete the order
    RemoveOrder(id);
    return Results.NoContent();
});
```

### 3. Status Codes

Status codes are numerical codes that indicate the outcome of an API request. They inform the calling application whether the API call was successful or if an error occurred.

#### Common Status Codes:

**200 - Success**
```csharp
app.MapGet("/products", () => 
{
    var products = GetAllProducts();
    return Results.Ok(products); // Returns 200 status code
});
```

**404 - Not Found**
```csharp
app.MapGet("/products/{id}", (int id) => 
{
    var product = FindProductById(id);
    if (product == null)
    {
        return Results.NotFound(); // Returns 404 status code
    }
    return Results.Ok(product);
});
```

**500 - Internal Server Error**
```csharp
app.MapGet("/products", () => 
{
    try
    {
        var products = GetAllProducts();
        return Results.Ok(products);
    }
    catch (Exception ex)
    {
        // Log the error
        Console.WriteLine($"Error: {ex.Message}");
        return Results.Problem("Internal server error"); // Returns 500 status code
    }
});
```

### 4. Payloads

Payload is the data exchanged between the client and server, often formatted as JSON. When an HTTP request is sent to an endpoint, the API processes it and responds with the status code and the data requested or updated.

#### Request Payload Example:
```json
{
    "productId": 5,
    "quantity": 2,
    "customerEmail": "customer@example.com"
}
```

#### Response Payload Example:
```json
{
    "orderId": 123,
    "productId": 5,
    "quantity": 2,
    "totalPrice": 59.98,
    "status": "confirmed"
}
```

#### .NET Minimal API Payload Handling:
```csharp
// Handle JSON payload in POST request
app.MapPost("/orders", (CreateOrderRequest request) => 
{
    var order = new Order
    {
        Id = GenerateNewId(),
        ProductId = request.ProductId,
        Quantity = request.Quantity,
        CustomerEmail = request.CustomerEmail,
        CreatedDate = DateTime.UtcNow,
        TotalPrice = CalculatePrice(request.ProductId, request.Quantity)
    };
    
    SaveOrder(order);
    
    // Return JSON response
    return Results.Created($"/orders/{order.Id}", new
    {
        OrderId = order.Id,
        ProductId = order.ProductId,
        Quantity = order.Quantity,
        TotalPrice = order.TotalPrice,
        Status = "confirmed"
    });
});

public record CreateOrderRequest(int ProductId, int Quantity, string CustomerEmail);
```

### 5. Dependency Injection

Dependency injection (DI) is a programming pattern that involves providing an object with its dependencies rather than having the object create them itself. This promotes loose coupling between objects, making code more modular, testable, and maintainable.

#### Example of DI in .NET Minimal API:

```csharp
// Service interface
public interface IProductService
{
    Task<IEnumerable<Product>> GetAllProductsAsync();
    Task<Product?> GetProductByIdAsync(int id);
    Task<Product> CreateProductAsync(Product product);
}

// Service implementation
public class ProductService : IProductService
{
    private readonly ILogger<ProductService> _logger;
    private readonly IProductRepository _repository;
    
    public ProductService(ILogger<ProductService> logger, IProductRepository repository)
    {
        _logger = logger;
        _repository = repository;
    }
    
    public async Task<IEnumerable<Product>> GetAllProductsAsync()
    {
        _logger.LogInformation("Retrieving all products");
        return await _repository.GetAllAsync();
    }
    
    public async Task<Product?> GetProductByIdAsync(int id)
    {
        _logger.LogInformation("Retrieving product with ID: {ProductId}", id);
        return await _repository.GetByIdAsync(id);
    }
    
    public async Task<Product> CreateProductAsync(Product product)
    {
        _logger.LogInformation("Creating new product: {ProductName}", product.Name);
        return await _repository.CreateAsync(product);
    }
}

// Program.cs - Register services
var builder = WebApplication.CreateBuilder(args);

// Register dependencies
builder.Services.AddScoped<IProductService, ProductService>();
builder.Services.AddScoped<IProductRepository, ProductRepository>();

var app = builder.Build();

// Use injected services in endpoints
app.MapGet("/products", async (IProductService productService) => 
{
    var products = await productService.GetAllProductsAsync();
    return Results.Ok(products);
});

app.MapGet("/products/{id}", async (int id, IProductService productService) => 
{
    var product = await productService.GetProductByIdAsync(id);
    return product != null ? Results.Ok(product) : Results.NotFound();
});

app.MapPost("/products", async (Product product, IProductService productService) => 
{
    var createdProduct = await productService.CreateProductAsync(product);
    return Results.Created($"/products/{createdProduct.Id}", createdProduct);
});
```

## Complete Example: E-commerce API

Here's a complete example that demonstrates all the concepts together:

```csharp
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

// Register services
builder.Services.AddScoped<IOrderService, OrderService>();
builder.Services.AddScoped<IProductService, ProductService>();

var app = builder.Build();

// Products endpoints
app.MapGet("/products", async (IProductService productService) => 
{
    try
    {
        var products = await productService.GetAllProductsAsync();
        return Results.Ok(products);
    }
    catch (Exception ex)
    {
        return Results.Problem("Failed to retrieve products");
    }
});

app.MapGet("/products/{id}", async (int id, IProductService productService) => 
{
    var product = await productService.GetProductByIdAsync(id);
    return product != null ? Results.Ok(product) : Results.NotFound();
});

// Orders endpoints
app.MapPost("/orders", async (CreateOrderRequest request, IOrderService orderService) => 
{
    try
    {
        var order = await orderService.CreateOrderAsync(request);
        return Results.Created($"/orders/{order.Id}", order);
    }
    catch (ArgumentException ex)
    {
        return Results.BadRequest(ex.Message);
    }
    catch (Exception ex)
    {
        return Results.Problem("Failed to create order");
    }
});

app.MapPut("/orders/{id}", async (int id, UpdateOrderRequest request, IOrderService orderService) => 
{
    try
    {
        var updatedOrder = await orderService.UpdateOrderAsync(id, request);
        return updatedOrder != null ? Results.Ok(updatedOrder) : Results.NotFound();
    }
    catch (Exception ex)
    {
        return Results.Problem("Failed to update order");
    }
});

app.MapDelete("/orders/{id}", async (int id, IOrderService orderService) => 
{
    try
    {
        var deleted = await orderService.DeleteOrderAsync(id);
        return deleted ? Results.NoContent() : Results.NotFound();
    }
    catch (Exception ex)
    {
        return Results.Problem("Failed to delete order");
    }
});

app.Run();

// Data models
public record Product(int Id, string Name, decimal Price);
public record Order(int Id, int ProductId, int Quantity, string CustomerEmail, decimal TotalPrice, DateTime CreatedDate);
public record CreateOrderRequest(int ProductId, int Quantity, string CustomerEmail);
public record UpdateOrderRequest(int Quantity);
```

## Summary

RESTful APIs within the .NET Minimal API framework rely on five key components:

1. **Endpoints** - URLs that serve as addresses for specific tasks
2. **HTTP Methods** - Standardized actions (GET, POST, PUT, DELETE)
3. **Status Codes** - Numerical indicators of request outcomes (200, 404, 500)
4. **Payloads** - JSON-formatted data exchanged between client and server
5. **Dependency Injection** - Pattern for providing reusable services automatically

These components work together to create efficient connections between systems, enabling scalable and maintainable web applications.