@page "/chat"
@using BlazorServerApp.Models;
@using Microsoft.AspNetCore.SignalR.Client;
@inject NavigationManager NavigationManager;

<h1>SignalR Chat</h1>
<p>Welcome to the SignalR chat application @($"{user.UserName}")!</p>
<p>Type your message below:</p>
<input  @bind="user.Message" type="text" placeholder="Type a message..." />
<button @onclick="sendMessage">Send</button>


<div style="margin-top: 20px;">
	<h3>Messages:</h3>
	<ul>
		@foreach (var message in messages)
		{
			<li>@message</li>
		}
	</ul>
</div>

@code {
	private HubConnection hubConnection;
	private User user;
	private List<string> messages = new List<string>();

	protected override async Task OnInitializedAsync()
	{
        user = new User { UserName = "User1", Message = string.Empty };
		hubConnection = new HubConnectionBuilder()
		.WithUrl(NavigationManager.ToAbsoluteUri("/notificationHu"))
		.Build();

		hubConnection.On<string, string>("ReceiveMessage", (user, message) =>
		{
			messages.Add($"{user}: {message}");
			InvokeAsync(StateHasChanged);
		});

		await hubConnection.StartAsync();
	}
	
	private async Task sendMessage()
	{
		    //if (!string.IsNullOrEmpty(user.Message))
		   // {
		        await hubConnection.SendAsync("SendMessage", user.UserName, user.Message);
		        user.Message = string.Empty;
		   // }
	}
}